# name: Deploy and Configure Development ENV

# on:
#   workflow_dispatch:

# jobs:
#   deploy:
#     runs-on: ubuntu-latest

#     env:
#       TF_VAR_private_key_path: ${{ secrets.SSH_PRIVATE_KEY }}
#       ANSIBLE_HOST_KEY_CHECKING: False

#     steps:
#       - name: Checkout Repository
#         uses: actions/checkout@v3

#       - name: Set up Terraform
#         uses: hashicorp/setup-terraform@v3
#         with:
#           terraform_version: 1.5.7

#       - name: Terraform Init
#         working-directory: ./terraform
#         run: terraform init

#       - name: Terraform Apply
#         working-directory: ./terraform
#         run: terraform apply -auto-approve

#       - name: Install jq
#         run: sudo apt-get install jq -y

#       - name: Generate Ansible Inventory
#         run: |
#           cd terraform
#           terraform output -json > tf_output.json
#           cd ..

#           ./scripts/generate_inventory.sh

#       - name: Set up SSH Key
#         run: |
#           mkdir -p ~/.ssh
#           echo "${{ secrets.SSH_PRIVATE_KEY }}" > ~/.ssh/id_rsa
#           chmod 600 ~/.ssh/id_rsa

#       - name: Run GitLab Playbook
#         run: |
#           cd ansible
#           ansible-playbook -i inventory/hosts.ini playbooks/gitlab.yml

#       # Optional: Pause to update token
#       - name: Wait for Token Input (Optional)
#         run: echo "Add registration_token manually to group_vars/runners.yml"

#       - name: Run GitLab Runners Playbook
#         run: |
#           cd ansible
#           ansible-playbook -i inventory/hosts.ini playbooks/runners.yml

#       - name: Run Harbor Playbook
#         run: |
#           cd ansible
#           ansible-playbook -i inventory/hosts.ini playbooks/harbor.yml
